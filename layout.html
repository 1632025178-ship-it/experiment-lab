<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>实验布局 - 抗菌实验系统</title>

<style>
:root{
    --primary:#2E7D32;
}

/* 页面整体 */
body{
    font-family:-apple-system, BlinkMacSystemFont,"Segoe UI",微软雅黑,sans-serif;
    background:#F5F7FA;
    margin:0;
    padding:0;
    color:#263238;
}

header{
    background:white;
    padding:16px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-bottom:1px solid #DDD;
}
nav a{
    margin-left:16px;
    text-decoration:none;
    color:#263238;
    padding:6px 10px;
    border-radius:999px;
}
nav a:hover{
    background:#A5D6A7;
    color:white;
}

h2{
    color:var(--primary);
    margin-top:25px;
}

/* ===================== 抑菌圈平板 ===================== */

.plate-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:25px;
    margin-bottom:40px;
}

.plate-box{
    perspective:1200px;
}

.plate{
    width:240px;
    height:240px;
    border-radius:50%;
    border:5px solid #ddd;
    background:#fafafa;
    margin:auto;
    position:relative;
    transition:transform .5s ease, box-shadow .4s ease;
    transform-style:preserve-3d;
}
.plate:hover{
    transform:rotateX(18deg) rotateY(-18deg);
    box-shadow:0 20px 40px rgba(0,0,0,0.25);
}

.plate-title{
    text-align:center;
    font-weight:600;
    margin-bottom:6px;
}

.well{
    width:88px;
    height:88px;
    border-radius:50%;
    background:#ffebee;
    border:2px solid #b71c1c;
    color:#333;
    position:absolute;
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    padding:4px;
    font-size:13px;
    cursor:pointer;
    transition:0.25s;
}
.well.active{
    background:#e8f5e9;
    border-color:#1b5e20;
}

.well.tl{ top:20px; left:20px; }
.well.tr{ top:20px; right:20px; }
.well.bl{ bottom:20px; left:20px; }
.well.br{ bottom:20px; right:20px; }

/* ===================== MIC 96孔布局 ===================== */

.mic-plate{
    display:inline-grid;
    grid-template-columns:repeat(12, 32px);
    gap:10px;
    background:#fff;
    padding:24px;
    border-radius:16px;
    box-shadow:0 4px 15px rgba(0,0,0,0.12);
    margin-bottom:40px;
}

.mic-well{
    width:30px;
    height:30px;
    border-radius:50%;
    background:#ffebee;
    border:2px solid #b71c1c;
    cursor:pointer;
    position:relative;
    transition:0.2s;
}

.mic-well.active{
    background:#e8f5e9;
    border-color:#1b5e20;
}

.mic-well:hover::after{
    content:attr(data-info);
    position:absolute;
    top:-34px;
    left:50%;
    transform:translateX(-50%);
    padding:4px 8px;
    background:#263238;
    color:white;
    font-size:11px;
    border-radius:4px;
    white-space:nowrap;
}

/* ===================== 配液表 ===================== */

table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th,td{
    border:1px solid #DDD;
    padding:6px 8px;
    text-align:center;
}
th{
    background:#E8F5E9;
}

</style>
</head>

<body>

<header>
    <h1>实验布局（抑菌圈 + MIC）</h1>
    <nav>
        <a href="index.html">首页</a>
        <a href="schedule.html">实验排班</a>
        <a href="layout.html">实验布局</a>
        <a href="entry.html">数据录入</a>
        <a href="sop.html">SOP</a>
    </nav>
</header>

<main style="max-width:1100px;margin:auto;padding:20px;">

<!-- ========================================================= -->
<!-- 1. 抑菌圈圆形板布局 -->
<!-- ========================================================= -->
<h2>⭕ 抑菌圈圆形平板布局（可点击标记）</h2>
<div id="plateArea"></div>

<script>
const strains=["EC","BS","AS","PS"];
const plants=["薄荷","迷迭香","柠檬皮","橙子皮","桑叶","枇杷叶","绿茶","干槐花","芦荟"];
const repeats=["R1","R2","R3"];

let wellState=JSON.parse(localStorage.getItem("PLATE_WELL_STATE")||"{}");
function savePlate(){ localStorage.setItem("PLATE_WELL_STATE",JSON.stringify(wellState)); }
function togglePlate(id){
    wellState[id]=!wellState[id];
    savePlate();
    document.getElementById(id).classList.toggle("active");
}

function wellHTML(strain,i,pos,label){
    const id=`${strain}_${i}_${pos}`;
    const active=wellState[id]?"active":"";
    return `<div id="${id}" class="well ${pos} ${active}" onclick="togglePlate('${id}')">${label}</div>`;
}

function renderPlates(){
    let html="";
    strains.forEach(strain=>{
        html+=`<h3>菌株：${strain}</h3><div class="plate-grid">`;

        let ptr=0,rpt=0;

        for(let i=1;i<=8;i++){

            if(i===8){
                html+=`
                <div class="plate-box">
                    <div class="plate-title">${strain}-${i}（对照）</div>
                    <div class="plate">
                        ${wellHTML(strain,i,"tl","阴性")}
                        ${wellHTML(strain,i,"tr","阳性")}
                        ${wellHTML(strain,i,"bl","空白")}
                        ${wellHTML(strain,i,"br","空白")}
                    </div>
                </div>`;
                continue;
            }

            const wells=[];
            for(let w=0;w<4;w++){
                if(ptr>=plants.length){ ptr=0; rpt++; }
                wells.push(plants[ptr]+"-"+repeats[rpt]);
                ptr++;
            }

            html+=`
            <div class="plate-box">
                <div class="plate-title">${strain}-${i}</div>
                <div class="plate">
                    ${wellHTML(strain,i,"tl",wells[0])}
                    ${wellHTML(strain,i,"tr",wells[1])}
                    ${wellHTML(strain,i,"bl",wells[2])}
                    ${wellHTML(strain,i,"br",wells[3])}
                </div>
            </div>`;
        }

        html+="</div>";
    });

    document.getElementById("plateArea").innerHTML=html;
}
renderPlates();
</script>

<!-- ========================================================= -->
<!-- 2. 96孔 MIC 板布局（真实 2×体系） -->
<!-- ========================================================= -->

<h2>96 孔 MIC 布局（2×稀释体系 — 可点击标记加样）</h2>
<div id="micArea"></div>

<script>
let micState = JSON.parse(localStorage.getItem("MIC96_STATE") || "{}");
function saveMic(){ localStorage.setItem("MIC96_STATE", JSON.stringify(micState)); }

function toggleMic(id){
    micState[id]=!micState[id];
    saveMic();
    document.getElementById(id).classList.toggle("active");
}

/* 真实实验提示文字 */
function wellInfo(rowIndex, col){

    const plant = plants[rowIndex];

    const dilution = [
        "C1：配制『100µL原液 + 100µL培养基』的 2×药液 → 加 100µL → 再加 100µL菌液",
        "C2：从 C1 取 100µL + 100µL培养基 → 加 100µL → +100µL菌液",
        "C3：从 C2 取 100µL + 100µL培养基 → 加 100µL → +100µL菌液",
        "C4：从 C3 取 100µL + 100µL培养基 → 加 100µL → +100µL菌液",
        "C5：从 C4 取 100µL + 100µL培养基 → 加 100µL → +100µL菌液",
        "C6：从 C5 取 100µL + 100µL培养基 → 加 100µL → +100µL菌液",
        "C7：从 C6 取 100µL + 100µL培养基 → 加 100µL → +100µL菌液",
        "C8：从 C7 取 100µL + 100µL培养基 → 加 100µL → +100µL菌液",
    ];

    if(col <= 8){
        return `${plant} — ${dilution[col-1]}`;
    }

    const ctrl = {
        9:"空白对照：200µL 培养基（无菌）",
        10:"生长对照：100µL 培养基 + 100µL 菌液",
        11:"溶剂对照：100µL 培养基 + 100µL 菌液（含同等乙醇）",
        12:"阳性对照：100µL 2×抗生素 + 100µL 菌液"
    };
    return ctrl[col];
}

/* 渲染 96孔板 */
function renderMIC(){
    let html="";
    const rows=["A","B","C","D","E","F","G","H"];

    strains.forEach(strain=>{
        html+=`<h3 style="margin:20px 0;">菌株：${strain}</h3>`;
        html+=`<div class="mic-plate">`;

        rows.forEach((row,rIndex)=>{
            for(let col=1;col<=12;col++){
                const id=`${strain}_${row}${col}`;
                const active = micState[id]?"active":"";
                const info = wellInfo(rIndex, col);

                html+=`
                <div id="${id}"
                    class="mic-well ${active}"
                    onclick="toggleMic('${id}')"
                    data-info="${info}">
                </div>`;
            }
        });

        html+=`</div>`;
    });

    document.getElementById("micArea").innerHTML=html;
}

renderMIC();
</script>

<!-- ========================================================= -->
<!-- 3. MIC 自动配液表（真实实验版） -->
<!-- ========================================================= -->

<h2>MIC 自动配液表（真实 2×稀释体系）</h2>
<div id="mixTable"></div>

<script>
function renderMix(){
    /* 真实实验 2×体系（逐级稀释） */
    const dil = [
        {label:"C1", formula:"100µL 原液 + 100µL 培养基"},
        {label:"C2", formula:"从 C1 取 100µL + 100µL 培养基"},
        {label:"C3", formula:"从 C2 取 100µL + 100µL 培养基"},
        {label:"C4", formula:"从 C3 取 100µL + 100µL 培养基"},
        {label:"C5", formula:"从 C4 取 100µL + 100µL 培养基"},
        {label:"C6", formula:"从 C5 取 100µL + 100µL 培养基"},
        {label:"C7", formula:"从 C6 取 100µL + 100µL 培养基"},
        {label:"C8", formula:"从 C7 取 100µL + 100µL 培养基"}
    ];

    let html=`<table><thead><tr><th>植物</th>`;
    dil.forEach(d=> html+=`<th>${d.label}</th>`);
    html+=`</tr></thead><tbody>`;

    plants.forEach(p=>{
        html+=`<tr><td>${p}</td>`;
        dil.forEach(d=>{
            html+=`<td>${d.formula}</td>`;
        });
        html+=`</tr>`;
    });

    html+=`</tbody></table>`;
    document.getElementById("mixTable").innerHTML=html;
}
renderMix();
</script>

</main>
</body>
</html>
