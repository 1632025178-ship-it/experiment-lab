<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>实验布局 - 抗菌实验系统</title>

<style>
:root{
    --primary:#2E7D32;
}

/* 页面整体 */
body{
    font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", 微软雅黑, sans-serif;
    background:#F5F7FA;
    margin:0;
    padding:0;
    color:#263238;
}

header{
    background:white;
    padding:16px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-bottom:1px solid #DDD;
}
nav a{
    margin-left:16px;
    text-decoration:none;
    color:#263238;
    padding:6px 10px;
    border-radius:999px;
}
nav a:hover{
    background:#A5D6A7;
    color:white;
}

h2{
    color:var(--primary);
    margin-top:25px;
}

/* 平板区域 */
.plate-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(260px,1fr));
    gap:25px;
    margin-bottom:40px;
}

/* 3D 培养皿 */
.plate-box{
    perspective:1200px;
}

.plate{
    width:240px;
    height:240px;
    border-radius:50%;
    border:5px solid #ddd;
    background:#fafafa;
    margin:auto;
    position:relative;
    transition:transform .5s ease, box-shadow .4s ease;
    transform-style:preserve-3d;
}
.plate:hover{
    transform:rotateX(18deg) rotateY(-18deg);
    box-shadow:0 20px 40px rgba(0,0,0,0.25);
}

/* 培养皿标题 */
.plate-title{
    text-align:center;
    font-weight:600;
    margin-bottom:6px;
}

/* 2×2 孔 */
.well{
    width:88px;
    height:88px;
    border-radius:50%;
    background:#ffebee; /* 默认红色（未加样） */
    border:2px solid #b71c1c;
    color:#333;
    position:absolute;
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    padding:4px;
    font-size:13px;
    cursor:pointer;
    transition:0.25s;
}

/* 加样后绿色 */
.well.active{
    background:#e8f5e9;
    border-color:#1b5e20;
}

/* 孔位置 */
.well.tl{ top:20px; left:20px; }
.well.tr{ top:20px; right:20px; }
.well.bl{ bottom:20px; left:20px; }
.well.br{ bottom:20px; right:20px; }

table{
    border-collapse:collapse;
    width:100%;
    margin:20px 0;
}
table th, table td{
    border:1px solid #DDD;
    padding:6px 8px;
    text-align:center;
}
table th{
    background:#E8F5E9;
}
</style>
</head>

<body>

<header>
    <h1>实验布局（抑菌圈 + MIC）</h1>
    <nav>
        <a href="index.html">首页</a>
        <a href="schedule.html">实验排班</a>
        <a href="layout.html">实验布局</a>
        <a href="entry.html">数据录入</a>
        <a href="sop.html">SOP</a>
    </nav>
</header>

<main style="max-width:1100px;margin:auto;padding:20px;">

<!-- ========================== 1. 抑菌圈布局 ========================== -->
<h2>⭕ 抑菌圈圆形平板布局（可点击标记是否加样）</h2>
<div id="plateArea"></div>

<script>
const strains = ["EC","BS","AS","PS"];
const plants = ["薄荷","迷迭香","柠檬皮","橙子皮","桑叶","枇杷叶","绿茶","干槐花","芦荟"];
const repeats = ["R1","R2","R3"];

const LS_KEY = "PLATE_WELL_STATE";
let wellState = JSON.parse(localStorage.getItem(LS_KEY) || "{}");

function saveState(){
    localStorage.setItem(LS_KEY, JSON.stringify(wellState));
}

function toggleWell(id){
    wellState[id] = !wellState[id];
    saveState();
    document.getElementById(id).classList.toggle("active");
}

function renderWell(strain,i,pos,label){
    const id = `${strain}_${i}_${pos}`;
    const active = wellState[id] ? "active" : "";
    return `<div id="${id}" class="well ${pos} ${active}" onclick="toggleWell('${id}')">${label}</div>`;
}

function renderPlates(){
    let html="";

    strains.forEach(strain=>{
        html += `<h3>菌株：${strain}</h3>`;
        html += `<div class="plate-grid">`;

        let ptr=0, rpt=0;

        for(let i=1;i<=8;i++){
            if(i===8){
                html+=`
                    <div class="plate-box">
                        <div class="plate-title">${strain}-${i}（对照）</div>
                        <div class="plate">
                            ${renderWell(strain,i,"tl","阴性")}
                            ${renderWell(strain,i,"tr","阳性")}
                            ${renderWell(strain,i,"bl","空白")}
                            ${renderWell(strain,i,"br","空白")}
                        </div>
                    </div>`;
                continue;
            }

            const wells=[];
            for(let w=0; w<4; w++){
                if(ptr>=plants.length){ ptr=0; rpt++; }
                wells.push(plants[ptr]+"-"+repeats[rpt]);
                ptr++;
            }

            html+=`
            <div class="plate-box">
                <div class="plate-title">${strain}-${i}</div>
                <div class="plate">
                    ${renderWell(strain,i,"tl",wells[0])}
                    ${renderWell(strain,i,"tr",wells[1])}
                    ${renderWell(strain,i,"bl",wells[2])}
                    ${renderWell(strain,i,"br",wells[3])}
                </div>
            </div>`;
        }

        html += `</div>`;
    });

    document.getElementById("plateArea").innerHTML = html;
}
renderPlates();
</script>

<!-- ========================== 2. MIC 布局 ========================== -->
<h2>96 孔 MIC 布局（自动生成）</h2>
<div id="micArea"></div>

<script>
function renderMIC(){
    let html="";

    strains.forEach(strain=>{
        html += `<h3 style="margin:20px 0 10px;">菌株：${strain}</h3>`;
        html += `<table><thead><tr><th>Row</th>${Array.from({length:12},(_,i)=>`<th>${i+1}</th>`).join("")}</tr></thead><tbody>`;

        const rows=["A","B","C","D","E"];
        
        for(let block=0; block<2; block++){
            rows.forEach((row,rIndex)=>{
                const plant = plants[rIndex + block*5];
                html += `<tr><td>${row}</td>`;

                for(let c=1;c<=8;c++){
                    html += `<td>${plant}_C${c}</td>`;
                }

                html += `<td>空白</td><td>生长对照</td><td>溶剂对照</td><td>阳性药</td>`;
                html += `</tr>`;
            });
        }

        html += `</tbody></table>`;
    });

    document.getElementById("micArea").innerHTML = html;
}
renderMIC();
</script>

<!-- ========================== 3. MIC 自动配液表 ========================== -->
<h2>MIC 自动配液表（2× 稀释体系）</h2>
<div id="mixTable"></div>

<script>
function renderMix(){
    const dil = [
        {label:"C1", e:200, m:0},
        {label:"C2", e:100, m:100},
        {label:"C3", e:50,  m:150},
        {label:"C4", e:25,  m:175},
        {label:"C5", e:13,  m:187},
        {label:"C6", e:6,   m:194},
        {label:"C7", e:3,   m:197},
        {label:"C8", e:2,   m:198},
    ];

    let html = `<table><thead><tr><th>植物</th>`;
    dil.forEach(d=> html+=`<th>${d.label}</th>`);
    html += `</tr></thead><tbody>`;

    plants.forEach(p=>{
        html += `<tr><td>${p}</td>`;
        dil.forEach(d=>{
            html += `<td>${d.e}µL + ${d.m}µL</td>`;
        });
        html += `</tr>`;
    });

    html += "</tbody></table>";
    document.getElementById("mixTable").innerHTML = html;
}
renderMix();
</script>

</main>
</body>
</html>
