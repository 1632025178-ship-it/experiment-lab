<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>æ•°æ®å½•å…¥ - æŠ—èŒå®éªŒç³»ç»Ÿ</title>

    <!-- Excel å¯¼å‡ºåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary: #2E7D32;
            --primary-light: #A5D6A7;
            --bg: #F5F7FA;
            --text: #263238;
        }
        * { box-sizing: border-box; margin:0; padding:0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", å¾®è½¯é›…é»‘, sans-serif;
            background: var(--bg);
            color: var(--text);
        }
        header {
            background: white;
            border-bottom: 1px solid #E0E0E0;
            padding: 16px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav a {
            margin-left: 16px;
            text-decoration: none;
            color: var(--text);
            padding: 6px 10px;
            border-radius: 999px;
        }
        nav a:hover { background: var(--primary-light); color:white; }
        main {
            max-width: 1100px;
            margin: 24px auto;
            padding: 16px;
            display:grid;
            grid-template-columns: 320px 1fr;
            gap:16px;
        }
        .card {
            background:white;
            border-radius:12px;
            padding:16px;
            box-shadow:0 2px 6px rgba(0,0,0,0.05);
        }
        label { display:block; margin:8px 0 4px; font-size:13px; }
        input,select {
            width:100%;
            padding:6px 8px;
            border-radius:6px;
            border:1px solid #CFD8DC;
            font-size:13px;
        }
        .btn {
            border:none;
            background:var(--primary);
            color:white;
            padding:8px 14px;
            border-radius:999px;
            cursor:pointer;
            width:100%;
            margin-top:10px;
        }
        .btn:hover { background:#1B5E20; }
        table {
            width:100%;
            border-collapse:collapse;
            font-size:12px;
        }
        th,td {
            border:1px solid #ECEFF1;
            padding:6px 8px;
            text-align:center;
        }
        th { background:#E8F5E9; }

        .export-buttons {
            margin: 20px;
            display: flex;
            gap: 12px;
        }
        .export-btn {
            padding: 10px 14px;
            background: #10b981;
            border: none;
            color: white;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        .export-btn:hover { background:#059669; }
    </style>
</head>

<body>

<!-- å¯¼å‡ºæŒ‰é’® -->
<div class="export-buttons">
    <button onclick="exportZOI()" class="export-btn">ğŸ“¤ å¯¼å‡º ZOI æ¨¡æ¿</button>
    <button onclick="exportMIC()" class="export-btn">ğŸ“¤ å¯¼å‡º MIC æ¨¡æ¿</button>
    <button onclick="exportSchedule()" class="export-btn">ğŸ“¤ å¯¼å‡ºæ’ç­æ¨¡æ¿</button>
</div>

<header>
    <h1>æ•°æ®å½•å…¥æ¨¡å—ï¼ˆZOI / MICï¼‰</h1>
    <nav>
        <a href="index.html">é¦–é¡µ</a>
        <a href="schedule.html">å®éªŒæ’ç­</a>
        <a href="layout.html">å®éªŒå¸ƒå±€</a>
        <a href="entry.html">æ•°æ®å½•å…¥</a>
        <a href="sop.html">SOP</a>
    </nav>
</header>

<main>
    <div class="card">
        <h3>æ–°è®°å½•å½•å…¥</h3>
        <label>å®éªŒæ–¹æ³•</label>
        <select id="method">
            <option value="ZOI">æŠ‘èŒåœˆç›´å¾„ (mm)</option>
            <option value="MIC">MIC æµ“åº¦ (%)</option>
        </select>

        <label>èŒæ ª</label>
        <select id="strain"></select>

        <label>æ¤ç‰©æå–ç‰©</label>
        <select id="extract"></select>

        <label>é‡å¤æ¬¡æ•°ï¼ˆRï¼‰</label>
        <input type="number" id="replicate" min="1" max="5" value="1" />

        <label>æ‰¹æ¬¡å·</label>
        <input type="text" id="batch" value="B001" />

        <label id="valueLabel">æŠ‘èŒåœˆç›´å¾„ (mm)</label>
        <input type="number" id="value" step="0.1" />

        <button class="btn" onclick="addRecord()">ä¿å­˜è®°å½•</button>
    </div>

    <div class="card">
        <h3>å·²å½•å…¥è®°å½•</h3>
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>æ–¹æ³•</th>
                <th>èŒæ ª</th>
                <th>æå–ç‰©</th>
                <th>é‡å¤</th>
                <th>æ‰¹æ¬¡</th>
                <th>æ•°å€¼</th>
            </tr>
            </thead>
            <tbody id="dataBody"></tbody>
        </table>
    </div>
</main>

<script>
// ================= Excel å¯¼å‡ºå™¨ ================= //
function exportZOI() {
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet([
        ["RecordID", "Date", "Strain", "Plant", "Replicate", "Diameter_mm", "Photo_Path"],
        ["ZOI001", "", "EC / BS / AS / PS", "P1-P10", "R1/R2/R3", "", ""]
    ]);
    XLSX.utils.book_append_sheet(wb, ws, "ZOI");
    XLSX.writeFile(wb, "zoi_template.xlsx");
}

function exportMIC() {
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet([
        ["RecordID", "Date", "Strain", "Plant", "Row", "Col", "Conc(%)", "OD600", "Status", "Photo_Path"],
        ["MIC001", "", "EC / BS / AS / PS", "P1-P10", "A-H", "1-12", "100 â†’ 0.78", "", "", ""]
    ]);
    XLSX.utils.book_append_sheet(wb, ws, "MIC");
    XLSX.writeFile(wb, "mic_template.xlsx");
}

function exportSchedule() {
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet([
        ["TaskID", "Date", "Time", "Content", "Status", "Note", "Screenshot"],
        ["S001", "", "09:00-12:00", "", "æœªå¼€å§‹ / è¿›è¡Œä¸­ / å·²å®Œæˆ", "", ""]
    ]);
    XLSX.utils.book_append_sheet(wb, ws, "Schedule");
    XLSX.writeFile(wb, "schedule_template.xlsx");
}

// ================= æ•°æ®å½•å…¥é€»è¾‘ ================= //
const extracts = [
    "P1 æŸ‘æ©˜æœçš®","P2 çŸ³æ¦´çš®","P3 è‹¹æœçš®","P4 é¦™è•‰çš®",
    "P5 æ‡æ·å¶","P6 èŠèŠ±/é‡‘é“¶èŠ±","P7 ç»¿èŒ¶","P8 è–„è·",
    "P9 è¿·è¿­é¦™","P10 èŠ¦èŸ"
];
const strains = ["EC","BS","AS","PS"];

const data = [];

function initForm(){
    const s = document.getElementById("strain");
    const e = document.getElementById("extract");

    strains.forEach(v=>{
        const o=document.createElement("option");
        o.value=v; o.textContent=v; s.appendChild(o);
    });
    extracts.forEach(v=>{
        const o=document.createElement("option");
        o.value=v; o.textContent=v; e.appendChild(o);
    });

    document.getElementById("method").addEventListener("change", e=>{
        document.getElementById("valueLabel").textContent =
            e.target.value==="ZOI"?"æŠ‘èŒåœˆç›´å¾„ (mm)":"MIC æµ“åº¦ (%)";
    });
}

function addRecord(){
    const r={
        id: Date.now(),
        method: method.value,
        strain: strain.value,
        extract: extract.value,
        replicate: replicate.value,
        batch: batch.value,
        value: parseFloat(value.value)
    };
    if(isNaN(r.value)){ alert("è¯·è¾“å…¥æ•°å€¼"); return; }
    data.push(r);
    renderTable();
    value.value="";
}

function renderTable(){
    const tb=document.getElementById("dataBody");
    tb.innerHTML="";
    data.slice().reverse().forEach(r=>{
        tb.innerHTML+=`
        <tr>
            <td>${r.id}</td>
            <td>${r.method}</td>
            <td>${r.strain}</td>
            <td>${r.extract}</td>
            <td>R${r.replicate}</td>
            <td>${r.batch}</td>
            <td>${r.value}</td>
        </tr>`;
    });
}

initForm();
</script>

</body>
</html>
